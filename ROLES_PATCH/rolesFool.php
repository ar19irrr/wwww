<?php
/**
 * ðŸƒ Ø§Ø­Ù…Ù‚ (Fool)
 * 
 * ØªÛŒÙ…: Ø±ÙˆØ³ØªØ§
 * ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ù¾ÛŒØ´Ú¯ÙˆÙ‡ØŒ ÙˆÙ„ÛŒ Ù†ØªÛŒØ¬Ù‡â€ŒÙ‡Ø§Ø´ Ø§Ø´ØªØ¨Ø§Ù‡Ù‡
 */

require_once __DIR__ . '/base.php';

class Fool extends Role {
    
    public function getName() {
        return 'Ø§Ø­Ù…Ù‚';
    }
    
    public function getEmoji() {
        return 'ðŸƒ';
    }
    
    public function getTeam() {
        return 'villager';
    }
    
    public function getDescription() {
        return "ØªÙˆ Ù¾ÛŒØ´Ú¯ÙˆðŸ‘³ðŸ»â€â™‚ï¸ Ù‡Ø³ØªÛŒ. Ù‡Ø± Ø´Ø¨ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù†Ù‚Ø´ ÛŒÚ© Ù†ÙØ± Ø±Ùˆ Ø¨Ø¨ÛŒÙ†ÛŒ.";
    }
    
    public function hasNightAction() {
        return true;
    }
    
    public function onGameStart() {
        // Ø¨Ù‡Ø´ Ù…ÛŒâ€ŒÚ¯Ù‡ Ù¾ÛŒØ´Ú¯ÙˆÙ‡
        $this->sendMessage("ØªÙˆ Ù¾ÛŒØ´Ú¯ÙˆðŸ‘³ðŸ»â€â™‚ï¸ Ù‡Ø³ØªÛŒ. Ù‡Ø± Ø´Ø¨ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù†Ù‚Ø´ ÛŒÚ© Ù†ÙØ± Ø±Ùˆ Ø¨Ø¨ÛŒÙ†ÛŒ.");
    }
    
    public function performNightAction($target = null) {
        if (!$target) {
            return [
                'success' => false,
                'message' => 'âŒ Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ù†ÙØ± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒ!'
            ];
        }
        
        $targetPlayer = $this->getPlayerById($target);
        if (!$targetPlayer) {
            return [
                'success' => false,
                'message' => 'âŒ Ø¨Ø§Ø²ÛŒÚ©Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯!'
            ];
        }
        
        if (!$targetPlayer['alive']) {
            return [
                'success' => false,
                'message' => 'âŒ Ø§ÛŒÙ† Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ø±Ø¯Ù‡!'
            ];
        }
        
        $this->logAction('see', $target);
        
        // Ù†ØªÛŒØ¬Ù‡ Ú©Ø§Ù…Ù„Ø§Ù‹ ØªØµØ§Ø¯ÙÛŒ Ùˆ Ø§Ø´ØªØ¨Ø§Ù‡
        $fakeResult = $this->getRandomFakeRole();
        $roleName = $this->getRoleDisplayName($fakeResult);
        
        return [
            'success' => true,
            'message' => "ðŸ‘³ðŸ»â€â™‚ï¸ ØªÙˆ Ø¯ÛŒØ¯ÛŒ Ú©Ù‡ {$targetPlayer['name']} ÛŒÙ‡ {$roleName} Ù‡Ø³Øª!",
            'seen_role' => $fakeResult
        ];
    }
    
    /**
     * Ù†ØªÛŒØ¬Ù‡ ØªØµØ§Ø¯ÙÛŒ Ø§Ø´ØªØ¨Ø§Ù‡
     */
    private function getRandomFakeRole() {
        // ÙÙ‚Ø· Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ ØªÙˆÛŒ Ø¨Ø§Ø²ÛŒ Ù‡Ø³ØªÙ† Ø±Ùˆ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡ (Ù…Ø«Ù„ Ù¾ÛŒØ´Ú¯ÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ)
        $availableRoles = [];
        foreach ($this->game['players'] as $p) {
            if ($p['alive']) {
                $availableRoles[] = $p['role'];
            }
        }
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±ÙˆØ§Ù‚Ø¹ÛŒ Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡
        $fakeRoles = ['werewolf', 'villager', 'seer', 'cultist', 'serial_killer'];
        $allOptions = array_merge($availableRoles, $fakeRoles);
        
        return $allOptions[array_rand($allOptions)];
    }
    
    /**
     * Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ Ù†Ù‚Ø´
     */
    private function getRoleDisplayName($role) {
        $names = [
            'villager' => 'ðŸ‘¨ðŸ» Ø±ÙˆØ³ØªØ§ÛŒÛŒ Ø³Ø§Ø¯Ù‡',
            'werewolf' => 'ðŸº Ú¯Ø±Ú¯ÛŒÙ†Ù‡',
            'seer' => 'ðŸ‘³ðŸ»â€â™‚ï¸ Ù¾ÛŒØ´Ú¯Ùˆ',
            'cultist' => 'ðŸ‘¤ ÙØ±Ù‚Ù‡â€ŒÚ¯Ø±Ø§',
            'serial_killer' => 'ðŸ”ª Ù‚Ø§ØªÙ„',
            'guardian_angel' => 'ðŸ‘¼ðŸ» ÙØ±Ø´ØªÙ‡ Ù†Ú¯Ù‡Ø¨Ø§Ù†',
            'detective' => 'ðŸ•µðŸ»â€â™‚ï¸ Ú©Ø§Ø±Ø§Ú¯Ø§Ù‡',
            'gunner' => 'ðŸ”« ØªÙÙ†Ú¯Ø¯Ø§Ø±',
            'fool' => 'ðŸƒ Ø§Ø­Ù…Ù‚',
            'harlot' => 'ðŸ’‹ Ù†Ø§ØªØ§Ø´Ø§',
            'cursed' => 'ðŸ˜¾ Ù†ÙØ±ÛŒÙ† Ø´Ø¯Ù‡',
            'traitor' => 'ðŸ–•ðŸ¿ Ø®Ø§Ø¦Ù†',
            'blacksmith' => 'âš’ï¸ Ø¢Ù‡Ù†Ú¯Ø±',
            'sandman' => 'ðŸ’¤ Ø®ÙˆØ§Ø¨Ú¯Ø°Ø§Ø±',
            'pacifist' => 'â˜®ï¸ ØµÙ„Ø­â€ŒØ·Ù„Ø¨',
            'wise_elder' => 'ðŸ“š Ø±ÛŒØ´ Ø³ÙÛŒØ¯',
            'wolf_man' => 'ðŸŒšðŸ‘¨ðŸ» Ú¯Ø±Ú¯Ù†Ù…Ø§',
            'clumsy' => 'ðŸ¤• Ù¾Ø³Ø± Ú¯ÛŒØ¬',
            'archer' => 'ðŸ¹ Ú©Ù…Ø§Ù†Ø¯Ø§Ø±',
            'alpha_wolf' => 'âš¡ï¸ðŸº Ú¯Ø±Ú¯ Ø¢Ù„ÙØ§',
            'wolf_cub' => 'ðŸ¶ ØªÙˆÙ„Ù‡ Ú¯Ø±Ú¯',
            'lycan' => 'ðŸŒðŸº Ú¯Ø±Ú¯ Ø§ÛŒÚ©Ø³',
            'oracle' => 'ðŸŒ€ Ù¾ÛŒØ´Ú¯ÙˆÛŒ Ù†Ú¯Ø§ØªÛŒÙˆÛŒ',
            'prince' => 'ðŸ¤´ðŸ» Ø´Ø§Ù‡Ø²Ø§Ø¯Ù‡',
            'mayor' => 'ðŸŽ–ï¸ Ú©Ø¯Ø®Ø¯Ø§',
            'sorcerer' => 'ðŸ”® Ø¬Ø§Ø¯ÙˆÚ¯Ø±',
            'cult_hunter' => 'ðŸ’‚ðŸ»â€â™‚ï¸ Ø´Ú©Ø§Ø±Ú†ÛŒ',
            'cupid' => 'ðŸ’˜ Ø§Ù„Ù‡Ù‡ Ø¹Ø´Ù‚',
            'hunter' => 'ðŸ‘®ðŸ»â€â™‚ï¸ Ú©Ù„Ø§Ù†ØªØ±',
            'apprentice_seer' => 'ðŸ™‡ðŸ»â€â™‚ï¸ Ø´Ø§Ú¯Ø±Ø¯ Ù¾ÛŒØ´Ú¯Ùˆ',
            'beholder' => 'ðŸ‘ï¸ Ø´Ø§Ù‡Ø¯',
            'builder' => 'ðŸ‘·ðŸ»â€â™‚ï¸ Ø¨Ù†Ø§',
            'doppelganger' => 'ðŸŽ­ Ù‡Ù…Ø²Ø§Ø¯',
            'wild_child' => 'ðŸ‘¶ðŸ» Ø¨Ú†Ù‡ ÙˆØ­Ø´ÛŒ',
            'drunk' => 'ðŸ» Ù…Ø³Øª',
            'tanner' => 'ðŸ‘º Ù…Ù†Ø§ÙÙ‚',
            'village_idiot' => 'ðŸ¤ª Ø§Ø­Ù…Ù‚',
            'cult_leader' => 'ðŸŽ© Ø±Ø¦ÛŒØ³ ÙØ±Ù‚Ù‡',
            'fire_king' => 'ðŸ”¥ðŸ¤´ðŸ» Ù¾Ø§Ø¯Ø´Ø§Ù‡ Ø¢ØªØ´',
            'ice_queen' => 'â„ï¸ðŸ‘¸ðŸ» Ù…Ù„Ú©Ù‡ ÛŒØ®ÛŒ',
            'forest_queen' => 'ðŸ§ðŸ»â€â™€ï¸ðŸº Ù…Ù„Ú©Ù‡ Ø¬Ù†Ú¯Ù„',
            'white_wolf' => 'ðŸºðŸŒ©ï¸ Ú¯Ø±Ú¯ Ø³ÙÛŒØ¯',
            'honey' => 'ðŸ§™ðŸ»â€â™€ï¸ Ø¹Ø¬ÙˆØ²Ù‡',
            'beta_wolf' => 'ðŸ’¤ðŸº Ú¯Ø±Ú¯ Ø®ÙˆØ§Ø¨Ø§Ù„Ùˆ',
            'ice_wolf' => 'ðŸºâ˜ƒï¸ Ú¯Ø±Ú¯ Ø¨Ø±ÙÛŒ',
            'sweetheart' => 'ðŸ‘°ðŸ» Ø¯Ù„Ø¨Ø±',
            'trouble' => 'ðŸ‘©ðŸ»â€ðŸŒ¾ Ø¯Ø®ØªØ± Ø¯Ø±Ø¯Ø³Ø±Ø³Ø§Ø²',
            'huntsman' => 'ðŸª“ Ù‡Ø§Ù†ØªØ³Ù…Ù†',
            'botanist' => 'ðŸ‚ Ú¯ÛŒØ§Ù‡ Ø´Ù†Ø§Ø³',
            'ruler' => 'ðŸ‘‘ Ø­Ø§Ú©Ù…',
            'grave_digger' => 'â˜ ï¸ Ú¯ÙˆØ±Ú©Ù†',
            'chemist' => 'ðŸ‘¨â€ðŸ”¬ Ø´ÛŒÙ…ÛŒØ¯Ø§Ù†',
            'chiang' => 'ðŸ‘©â€ðŸ¦³ Ú†ÛŒØ§Ù†Ú¯',
            'davina' => 'ðŸ¾ Ø¯Ø§ÙˆÛŒÙ†Ø§',
            'knight' => 'ðŸ—¡ï¸ Ø´ÙˆØ§Ù„ÛŒÙ‡',
            'spy' => 'ðŸ¦¹ðŸ»â€â™‚ï¸ Ø¬Ø§Ø³ÙˆØ³',
            'vampire' => 'ðŸ§›ðŸ»â€â™‚ï¸ ÙˆÙ…Ù¾Ø§ÛŒØ±',
            'bloodthirsty' => 'ðŸ§›ðŸ»â€â™€ï¸ ÙˆÙ…Ù¾Ø§ÛŒØ± Ø§ØµÛŒÙ„',
            'count_vampire' => 'ðŸ’ðŸ§›ðŸ» Ú©Ù†Øª ÙˆÙ…Ù¾Ø§ÛŒØ±',
            'lilith' => 'ðŸðŸ‘©ðŸ»â€ðŸ¦³ Ù„ÛŒÙ„ÛŒØ«',
            'djinn' => 'ðŸ§žâ€â™‚ï¸ Ø¯ÛŒØ§Ù†',
            'bride_dead' => 'ðŸ‘°â€â™€ï¸â˜ ï¸ Ø¹Ø±ÙˆØ³ Ù…Ø±Ø¯Ú¯Ø§Ù†',
            'magneto' => 'ðŸ§² Ù…Ú¯Ù†ÛŒØªÙˆ',
            'black_knight' => 'ðŸ¥·ðŸ—¡ï¸ Ø´ÙˆØ§Ù„ÛŒÙ‡ ØªØ§Ø±ÛŒÚ©ÛŒ',
            'princess' => 'ðŸ‘¸ðŸ» Ù¾Ø±Ù†Ø³Ø³',
            'phoenix' => 'ðŸª¶ Ù‚Ù‚Ù†ÙˆØ³',
            'enchanter' => 'ðŸ§™ðŸ»â€â™‚ï¸ Ø§ÙØ³ÙˆÙ†Ú¯Ø±',
            'joker' => 'ðŸ¤¡ Ø¬ÙˆÚ©Ø±',
            'harley_quinn' => 'ðŸ‘©ðŸ»â€ðŸŽ¤ Ù‡Ø§Ø±Ù„ÛŒ Ú©ÙˆÛŒÛŒÙ†',
            'bomber' => 'ðŸ’£ Ø¨Ù…Ø¨â€ŒÚ¯Ø°Ø§Ø±',
            'frankenstein' => 'ðŸ§Ÿâ€â™‚ï¸ðŸª– ÙØ±Ø§Ù†Ú©Ø´ØªØ§ÛŒÙ†',
            'lucifer' => 'ðŸ‘¹ Ù„ÙˆØ³ÛŒÙØ±',
            'thief' => 'ðŸ‘¿ Ø¯Ø²Ø¯',
            'mummy' => 'âš°ï¸ Ù…ÙˆÙ…ÛŒØ§ÛŒÛŒ',
            'ghost' => 'ðŸ‘» Ø±ÙˆØ­',
            'cultist' => 'ðŸ‘¤ ÙØ±Ù‚Ù‡â€ŒÚ¯Ø±Ø§'
        ];
        
        return $names[$role] ?? $role;
    }
    
    /**
     * ÙˆÙ‚ØªÛŒ Ø§Ø­Ù…Ù‚ Ù…ÛŒâ€ŒÙ…ÛŒØ±Ù‡ - ÙØ§Ø´ Ø´Ø¯Ù† Ù†Ù‚Ø´ ÙˆØ§Ù‚Ø¹ÛŒ
     */
    public function onDeath($killer = null, $method = null) {
        // Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ø®ÙˆØ¯Ø´
        $this->sendMessage("ðŸ’€ Ù…Ø±Ø¯ÛŒ... ÙˆÙ„ÛŒ Ø§Ù„Ø§Ù† Ù‡Ù…Ù‡ ÙÙ‡Ù…ÛŒØ¯Ù† Ú©Ù‡ ØªÙˆ ÙˆØ§Ù‚Ø¹Ø§Ù‹ ðŸƒ Ø§Ø­Ù…Ù‚ Ø¨ÙˆØ¯ÛŒØŒ Ù†Ù‡ Ù¾ÛŒØ´Ú¯Ùˆ!");
        
        // Ù¾ÛŒØ§Ù… Ø¹Ù…ÙˆÙ…ÛŒ
        $this->sendToGroup(
            "Ø¨Ø¯Ù† Ø®ÙˆÙ†ÛŒÙ† ÛŒÚ©ÛŒ Ø§Ø² Ø§Ù‡Ø§Ù„ÛŒ Ø±ÙˆØ³ØªØ§ Ø±ÙˆØŒ Ú†Ù†Ø¯ Ù…ØªØ± Ø¬Ù„Ùˆ ØªØ± Ø§Ø² Ø®ÙˆÙ†Ù‡â€ŒØ´ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒÙ… Ú©Ù‡ Ø±ÙˆÛŒ Ø²Ù…ÛŒÙ† Ø§ÙØªØ§Ø¯Ù‡. " .
            "Ø¯Ø± Ø­Ø§Ù„ÛŒ Ú©Ù‡ Ú¯Ø±Ú¯â€ŒÙ‡Ø§ Ø´Ú©Ù…Ø´ Ø±Ùˆ Ù¾Ø§Ø±Ù‡ Ú©Ø±Ø¯Ù†ØŒ ÙˆÙ„ÛŒ Ù‡Ù†ÙˆØ² Ù†ÙØ³ Ù…ÛŒâ€ŒÚ©Ø´Ù‡. " .
            "ØµØ¨Ø± Ú©Ù†ÛŒØ¯ Ø§Ù†Ú¯Ø§Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ø¯ ÛŒÙ‡ Ú†ÛŒØ²ÛŒ Ø¨Ù‡Ù…ÙˆÙ† Ø¨Ú¯Ù‡... " .
            "Ø®Ø¨ {$this->player['name']} ØªÙˆÛŒ Ø¢Ø®Ø±ÛŒÙ† Ù„Ø­Ø¸Ø§Øª Ø¹Ù…Ø±Ø´ Ø§Ø¹ØªØ±Ø§Ù Ú©Ø±Ø¯ Ú©Ù‡ Ù¾ÛŒØ´Ú¯ÙˆÛŒÛŒ Ø¨Ù„Ø¯ Ù†Ø¨ÙˆØ¯Ù‡! " .
            "Ø§ÙˆÙ† ÛŒÙ‡ ðŸƒ Ø§Ø­Ù…Ù‚ Ø¨ÙˆØ¯! Ø§Ù†Ú¯Ø§Ø±ÛŒ Ú¯Ø±Ú¯â€ŒÙ‡Ø§ Ù‡Ù… Ø§ÙˆÙ†Ùˆ Ø¨Ø§ Ù¾ÛŒØ´Ú¯Ùˆ Ø§Ø´ØªØ¨Ø§Ù‡ Ú¯Ø±ÙØªÙ‡ Ø¨ÙˆØ¯Ù† Ú©Ù‡ Ù‡Ù…ÙˆÙ†Ø·ÙˆØ±ÛŒ ÙˆÙ„Ø´ Ú©Ø±Ø¯Ù† Ùˆ Ø±ÙØªÙ†.."
        );
    }
    
    public function getValidTargets($phase = 'night') {
        $targets = [];
        foreach ($this->getOtherAlivePlayers() as $p) {
            $targets[] = [
                'id' => $p['id'],
                'name' => $p['name'],
                'callback' => 'seer_' . $p['id'] // callback Ù…Ø«Ù„ Ù¾ÛŒØ´Ú¯Ùˆ!
            ];
        }
        return $targets;
    }
}